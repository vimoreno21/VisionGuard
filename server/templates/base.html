<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionGuard Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
  </head>
  <body>
    <div class="app-container">
      <!-- Header -->
      <header class="app-header">
        <div class="logo">
          <span class="logo-icon">üõ°Ô∏è</span>
          <h1>VisionGuard</h1>
        </div>
        <div class="header-actions">
          <button class="notification-btn">
            <span>üîî</span>
            <span>Notifications</span>
          </button>
          <div class="user-avatar">üë§</div>
        </div>
      </header>

      <!-- Alerts include -->
      {% include "alerts.html" %}

      <!-- Page content -->
      {% block content %}{% endblock %}

      <!-- Footer -->
      <footer class="app-footer">
        <div class="footer-copyright">
          ¬© 2025 VisionGuard. All rights reserved.
        </div>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Contact Support</a>
        </div>
      </footer>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const uploadBtn = document.getElementById("uploadBtn");
        const photoUpload = document.getElementById("photoUpload");
        if (uploadBtn && photoUpload) {
          uploadBtn.addEventListener("click", function() {
            photoUpload.click();
          });
        }
      });
    </script>    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        var video = document.getElementById('liveStream');
        console.log("Video element:", video);
        if (video) {
          if (Hls.isSupported()) {
            console.log("HLS is supported, creating instance...");
            var hls = new Hls();
            hls.on(Hls.Events.ERROR, function(event, data) {
              console.error("HLS error:", data);
            });
            hls.loadSource('/static/live/stream.m3u8');
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function() {
              console.log("Manifest parsed, playing video...");
              video.play();
            });
          } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            console.log("Native HLS support detected, setting video source...");
            video.src = '/static/live/stream.m3u8';
            video.addEventListener('loadedmetadata', function() {
              console.log("Metadata loaded, playing video...");
              video.play();
            });
          } else {
            console.error("HLS not supported in this browser");
          }
        }
      });
    </script> 
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("people-inside-list");

        function fetchPeopleInside() {
          fetch("/api/current_people")
            .then(res => res.json())
            .then(data => {
              container.innerHTML = "";
              data.people.forEach(person => {
                const card = document.createElement("div");
                card.style.display = "flex";
                card.style.alignItems = "center";
                card.style.marginBottom = "10px";

                let imgOrPlaceholder;
                if (person.face_image) {
                  imgOrPlaceholder = document.createElement("img");
                  imgOrPlaceholder.src = person.face_image;
                  imgOrPlaceholder.alt = person.name;
                  imgOrPlaceholder.style.width = "50px";
                  imgOrPlaceholder.style.height = "50px";
                  imgOrPlaceholder.style.borderRadius = "50%";
                  imgOrPlaceholder.style.objectFit = "cover";
                  imgOrPlaceholder.style.marginRight = "10px";
                } else {
                  imgOrPlaceholder = document.createElement("div");
                  imgOrPlaceholder.textContent = "Unknown";
                  imgOrPlaceholder.style.width = "50px";
                  imgOrPlaceholder.style.height = "50px";
                  imgOrPlaceholder.style.borderRadius = "50%";
                  imgOrPlaceholder.style.backgroundColor = "#ccc";
                  imgOrPlaceholder.style.display = "flex";
                  imgOrPlaceholder.style.alignItems = "center";
                  imgOrPlaceholder.style.justifyContent = "center";
                  imgOrPlaceholder.style.marginRight = "10px";
                }

                const nameSpan = document.createElement("span");
                nameSpan.style.fontSize = "14px";
                nameSpan.textContent = person.name;

                card.appendChild(imgOrPlaceholder);
                card.appendChild(nameSpan);
                container.appendChild(card);
              });
            })
            .catch(err => console.error("Error fetching people:", err));
        }

        fetchPeopleInside();
        setInterval(fetchPeopleInside, 2000);
      });
    </script>         
  </body>
</html>
